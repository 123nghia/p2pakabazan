<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>P2P Trading Test UI</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { margin-top: 40px; }
    input, select, button { margin: 5px; padding: 8px; }
    .section { border: 1px solid #ddd; padding: 15px; margin-bottom: 20px; border-radius: 8px; }
    pre { background: #f4f4f4; padding: 10px; border-radius: 5px; }
  </style>
</head>
<body>

<h1>P2P Trading Test UI</h1>

<!-- Create Order -->
<div class="section">
  <h2>Create Order</h2>
  <label>Token:</label>
  <input id="token" value="USDT"><br>
  <label>Type:</label>
  <select id="type">
    <option value="SELL">SELL</option>
   
  </select><br>
  <label>Amount:</label>
  <input id="amount" type="number" value="100"><br>
  <label>Price:</label>
  <input id="price" type="number" value="24000"><br>
  <label>Min Limit:</label>
  <input id="minLimit" type="number" value="10"><br>
  <label>Max Limit:</label>
  <input id="maxLimit" type="number" value="100"><br>
  <label>Payment Method:</label>
  <input id="paymentMethod" value="BANK_TRANSFER"><br>
  <label>Fiat Account:</label>
  <input id="fiatAccount" value="123456789 - Vietcombank"><br>
  <button onclick="createOrder()">Create Order</button>
  <pre id="orderResult"></pre>
</div>

<!-- Get Orders -->
<div class="section">
  <h2>List Orders</h2>
  <button onclick="getOrders()">Load Orders</button>
  <pre id="ordersList"></pre>
</div>

<!-- Create Trade -->
<div class="section">
  <h2>Create Trade</h2>
  <label>Order ID:</label>
  <input id="orderId" type="number"><br>
  <label>Amount:</label>
  <input id="tradeAmount" type="number" value="50"><br>
  <button onclick="createTrade()">Create Trade</button>
  <pre id="tradeResult"></pre>
</div>

<!-- Confirm Payment -->
<div class="section">
  <h2>Confirm Payment</h2>
  <label>Trade ID:</label>
  <input id="tradeIdPay" type="number"><br>
  <button onclick="confirmPayment()">Confirm Payment</button>
  <pre id="paymentResult"></pre>
</div>

<!-- Confirm Received -->
<div class="section">
  <h2>Confirm Received</h2>
  <label>Trade ID:</label>
  <input id="tradeIdRecv" type="number"><br>
  <button onclick="confirmReceived()">Confirm Received</button>
  <pre id="receiveResult"></pre>
</div>

<!-- Open Dispute -->
<div class="section">
  <h2>Open Dispute</h2>
  <label>Trade ID:</label>
  <input id="tradeIdDispute" type="number"><br>
  <label>Reason:</label>
  <input id="disputeReason" type="text" value="Payment not received"><br>
  <label>Evidence:</label>
  <input id="disputeEvidence" type="text" value="Screenshot of transfer"><br>
  <button onclick="openDispute()">Open Dispute</button>
  <pre id="disputeResult"></pre>
</div>

<!-- Get Dispute -->
<div class="section">
  <h2>Get Dispute Details</h2>
  <label>Trade ID:</label>
  <input id="tradeIdDisputeGet" type="number"><br>
  <button onclick="getDispute()">Get Dispute</button>
  <pre id="disputeDetails"></pre>
</div>

<script>
  const API_BASE = "http://localhost:8080/api/p2p";

  const SELLER_TOKEN = "eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIxIiwiaWF0IjoxNzU4OTY1MDc0LCJleHAiOjE3NTkwNTE0NzR9.NRSIfR0i6C8y3OwgLwGGjQSaASh01eO1mvAnmjGjgoQ";
  const BUYER_TOKEN  = "eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIyIiwiaWF0IjoxNzU4OTY1MTc4LCJleHAiOjE3NTkwNTE1Nzh9.VCzAKbdNGwi8mFEfCOMMWQ2W99zfrCyTBl-GccEtOYU";

  async function callApi(url, method, body, token, resultId) {
    try {
      const res = await fetch(API_BASE + url, {
        method,
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer " + token
        },
        body: body ? JSON.stringify(body) : null
      });
      const data = await res.json();
      document.getElementById(resultId).textContent = JSON.stringify(data, null, 2);
    } catch (err) {
      document.getElementById(resultId).textContent = "Error: " + err;
    }
  }

  function createOrder() {
    const body = {
      type: document.getElementById("type").value,
      token: document.getElementById("token").value,
      amount: parseFloat(document.getElementById("amount").value),
      price: parseFloat(document.getElementById("price").value),
      minLimit: parseFloat(document.getElementById("minLimit").value),
      maxLimit: parseFloat(document.getElementById("maxLimit").value),
      paymentMethod: document.getElementById("paymentMethod").value,
      fiatAccount: document.getElementById("fiatAccount").value
    };
    callApi("/orders", "POST", body, SELLER_TOKEN, "orderResult");
  }

  function getOrders() {
    callApi("/orders", "GET", null, BUYER_TOKEN, "ordersList");
  }

  function createTrade() {
    const body = {
      orderId: parseInt(document.getElementById("orderId").value),
      amount: parseFloat(document.getElementById("tradeAmount").value)
    };
    callApi("/trades", "POST", body, BUYER_TOKEN, "tradeResult");
  }

  function confirmPayment() {
    const tradeId = document.getElementById("tradeIdPay").value;
    callApi("/trades/" + tradeId + "/confirm-payment", "POST", null, BUYER_TOKEN, "paymentResult");
  }

  function confirmReceived() {
    const tradeId = document.getElementById("tradeIdRecv").value;
    callApi("/trades/" + tradeId + "/confirm-received", "POST", null, SELLER_TOKEN, "receiveResult");
  }

  function openDispute() {
    const tradeId = document.getElementById("tradeIdDispute").value;
    const reason = document.getElementById("disputeReason").value;
    const evidence = document.getElementById("disputeEvidence").value;
    callApi(`/trades/${tradeId}/dispute`, "POST", { reason, evidence }, BUYER_TOKEN, "disputeResult");
  }

  function getDispute() {
    const tradeId = document.getElementById("tradeIdDisputeGet").value;
    callApi(`/trades/${tradeId}/dispute`, "GET", null, BUYER_TOKEN, "disputeDetails");
  }
</script>
</body>
</html>
